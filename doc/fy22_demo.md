# FY22ãƒ‡ãƒ¢æ‰‹é †

# ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

ref. [ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½ç½®ã¥ã‘](./project_positioning.md) 

## ã‚³ãƒ³ãƒ†ãƒŠãƒ™ãƒ¼ã‚¹ã®æ¤œè¨¼ç’°å¢ƒ

ã‚³ãƒ³ãƒ†ãƒŠãƒ™ãƒ¼ã‚¹ã®NWãƒãƒ¼ãƒ‰ (CNF; Cloud-native Network Function) ã‚’ä½¿ç”¨ã—ã¦æ¤œè¨¼ç’°å¢ƒã‚’ä½œã‚Œã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªåŠ¹æœãŒæœŸå¾…ã§ãã¾ã™ã€‚

- ç’°å¢ƒã‚’ç´ æ—©ãç«‹ã¦ã‚‰ã‚Œã‚‹ã“ã¨
    - ã‚³ãƒ³ãƒ†ãƒŠãƒ«ãƒ¼ã‚¿ã‚’ç”¨ã„ã¦ç’°å¢ƒä½œæˆã™ã‚‹ã“ã¨ã§æ™‚é–“çŸ­ç¸®
- ç’°å¢ƒå…¨ä½“ãŒæ¤œè¨¼ã§ãã‚‹ã“ã¨
    - è»½é‡ãªãƒ«ãƒ¼ã‚¿ã§åå®¹åŠ¹ç‡ã‚¢ãƒƒãƒ—
    - ä»®æƒ³åŒ–ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆ

åˆ¥é€”ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã«ã‚ˆã‚‹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®å‹•ä½œæ¤œè¨¼ã‚‚å®Ÿæ–½ã—ã¦ã„ã¾ã™ãŒã€ãã“ã§ã®èª²é¡Œã«å¯¾ã—ã¦ã‚‚ä»¥ä¸‹ã®ç‚¹ã‚’ç‹™ã£ã¦ã„ã¾ã™ã€‚

- ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã®åˆ¶ç´„å›é¿
    - ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã¯ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ—ãƒ¬ãƒ¼ãƒ³ã‚’ç‹¬è‡ªã«å†å®Ÿè£…ã—ã¦ã„ã‚‹ãŸã‚ã€ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å¯èƒ½ãªå‹•ä½œãŒé™å®šã•ã‚Œã‚‹
    - ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿å´ã®ãƒã‚°ãŒã‚ã‚‹ã¨å•é¡Œã®åˆ‡ã‚Šåˆ†ã‘ç­‰å¯¾å¿œãŒé›£ã—ã„

ãŸã ã—ã€ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ã§èª¬æ˜ã—ãŸé€šã‚Šã€æœ¬ç•ªç’°å¢ƒã§è€ƒæ…®ã™ã¹ãäº‹é …ã®ã†ã¡ã€ã‚³ãƒ³ãƒ†ãƒŠã§å†ç¾å¯èƒ½ãªç¯„å›²ã«ã¯é™ã‚ŠãŒã‚ã‚Šã¾ã™ã€‚æ©Ÿèƒ½ã‚’çµã£ã¦æ¤œè¨¼ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

- L3ä»¥ä¸Šã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã«çµã‚‹
    - ä»®æƒ³ç’°å¢ƒ(VM/ã‚³ãƒ³ãƒ†ãƒŠ)ã§ã¯ã€L2ä»¥ä¸‹ã®æŒ™å‹•ã¯ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã—ã«ãã„
- æ©Ÿèƒ½é¢ã®æ¤œè¨¼ã«çµã‚‹
    - æ€§èƒ½ã‚„ã‚­ãƒ£ãƒ‘ã‚·ãƒ†ã‚£ç­‰ã®éæ©Ÿèƒ½é¢ã«ã¤ã„ã¦ã¯ã€æœ¬ç•ªåŒç­‰ã®å†ç¾ã¯ã§ããªã„
    - æ©Ÿèƒ½ã«ã¤ã„ã¦ã‚‚ã€ç‰¹å®šã®ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã‚„OSå›ºæœ‰ã®æ©Ÿèƒ½ã«ä¾å­˜ã™ã‚‹ã‚‚ã®ã¯å†ç¾ã§ãã¾ã›ã‚“

## å¯æ¬æ€§ã®å®Ÿç¾

æ—¢å­˜ã®(æœ¬ç•ª)ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ã‚³ãƒ³ãƒ†ãƒŠã§å†ç¾ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€ãã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®é•ã„ã‹ã‚‰ã‚³ãƒ³ãƒ•ã‚£ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãã®ã¾ã¾æµç”¨ã—ã¦ä½¿ç”¨ã™ã‚‹ã¨ã„ã†ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚(å®Ÿéš›ã«ä½¿ç”¨ã™ã‚‹æ©Ÿå™¨ã‚„ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã«ã‚ˆã‚Šã¾ã™ãŒã€æœ¬ãƒ‡ãƒ¢ã®ä¸­ã§ã¯æœ¬ç•ªç’°å¢ƒå†… Cisco ãƒãƒ¼ãƒ‰ã‚’ã€æ¤œè¨¼ç’°å¢ƒã§ã¯ Juniper cRPD ã«ç½®ãæ›ãˆãŸã‚Šã—ã¦ã„ã¾ã™ã€‚ã‚³ãƒ³ãƒ•ã‚£ã‚°ã®ä¸€éƒ¨ã‚’å‰Šã‚‹ã¨ã‹ã€ã¡ã‚‡ã£ã¨ã—ãŸæ›¸ãæ›ãˆã®ãƒ¬ãƒ™ãƒ«ã‚’è¶…ãˆã¦ä½œã‚Šå¤‰ãˆã‚‹ã“ã¨ã‚’æƒ³å®šã—ã¦ã„ã¾ã™ã€‚)

![portability](./fig_fy22demo/portability.png)

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€ã„ã£ãŸã‚“ç‰¹å®šã®OSã‚„æ©Ÿå™¨ã«ä¾å­˜ã—ãªã„ãƒ¢ãƒ‡ãƒ«ãƒ‡ãƒ¼ã‚¿ã«å¤‰æ›ã™ã‚‹ã“ã¨ã§ã€æŠ½è±¡åŒ–ã¨åˆ¥ãªç’°å¢ƒã¸ã®ã€Œç¿»è¨³ã€ã‚’ã™ã‚‹å½¢ã‚’ã¨ã£ã¦ã„ã¾ã™ã€‚

- æœ¬æ¥configã«ã¯æ„å›³ãŒã‚ã‚‹ã¯ãšï¼æ„å‘³ã‚’è§£é‡ˆã—ã¦å¤‰æ›ã™ã¹ã
    - è¨€èªé–“ã®ç¿»è¨³ã¨åŒã˜
- Configã«ä¾å­˜ã—ãªã„ãƒ¢ãƒ‡ãƒ«ã‚’çµŒç”±
    - æ±ºå®šè«–çš„ï¼ˆnot ç¢ºç‡è«–çš„ï¼‰ã«å¤‰æ›ã™ã‚‹
    - å…¥å‡ºåŠ›ã€Œè¨€èªã€ãŒè¤‡æ•°ã«ãªã£ã¦ã‚‚å¤‰æ›ãƒ†ãƒ¼ãƒ–ãƒ«ãŒçˆ†ç™ºã—ãªã„

![translate](./fig_fy22demo/translate.png)

# ãƒ‡ãƒ¢æ¦‚è¦

## æ¦‚è¦

å›³ã®ã‚ˆã†ãª3æ‹ ç‚¹ãŒæ¥ç¶šã•ã‚ŒãŸãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã§ã€æ‹ ç‚¹é–“ã®ã‚µãƒ¼ãƒ(ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ)ç§»è»¢ã‚’è€ƒãˆã¾ã™ã€‚å„æ‹ ç‚¹ã¯ OSPF ã§çµŒè·¯äº¤æ›ã‚’ã—ã¦ã„ã‚‹ãŸã‚ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç§»è»¢ã«ä¼´ã†ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®çµŒè·¯åˆ¶å¾¡è¨­å®šã‚’å¤‰æ›´ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãƒ‡ãƒ¢ã‚·ãƒŠãƒªã‚ªã¨ã—ã¦ã¯ã€OSPF ã®çµŒè·¯å†é…å¸ƒã®è¨­å®šãƒŸã‚¹ãŒã‚ã‚Šã€ç§»è»¢å¾Œã®ã‚µãƒ¼ãƒã§é€šä¿¡ãƒˆãƒ©ãƒ–ãƒ«ãŒèµ·ãã‚‹ã‚±ãƒ¼ã‚¹ã‚’è€ƒãˆã¾ã™ã€‚

![demo_env](./fig_fy22demo/demo_env.png)

ã“ã†ã—ãŸãƒˆãƒ©ãƒ–ãƒ«ã¯ã€å¾“æ¥ã®æ¤œè¨¼ç’°å¢ƒ(ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ãƒ™ãƒ¼ã‚¹)ã§ã¯ç‰¹å®šã®æ‹ ç‚¹ã®ã¿ã‚’ç¸®å°ãƒ»é™å®šã—ã¦å†ç¾ã›ã–ã‚‹ã‚’å¾—ãšã€æ¤œè¨¼ã«å«ã‚ã‚‰ã‚Œãªã„ç®‡æ‰€ã‚„ãƒ†ã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ãŒæ®‹ã£ã¦ã—ã¾ã†ã‚‚ã®ã§ã—ãŸã€‚æœ¬ãƒ‡ãƒ¢ã§ã¯ã€ã‚³ãƒ³ãƒ†ãƒŠãƒ™ãƒ¼ã‚¹ã«ç’°å¢ƒå…¨ä½“ã‚’å†ç¾ã—ã€ã€Œãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å…¨ä½“ã®å‹•ãã€ã®å•é¡Œã‚’æ¤œè¨¼ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‹ã©ã†ã‹ã€ãã‚ŒãŒã©ã‚Œãã‚‰ã„ã®ã‚³ã‚¹ãƒˆ(ãƒªã‚½ãƒ¼ã‚¹)ã§å¯èƒ½ã«ãªã‚‹ã‹ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚

## ãƒ‡ãƒ¢ã®æµã‚Œ

ä»¥ä¸‹ã®ç”¨èªã‚’è¨­å®šã—ã¾ã™ã€‚

- ä½œæ¥­ãƒ•ã‚§ãƒ¼ã‚º(ç¾çŠ¶ãƒ»ä¿®æ­£å¾Œ)ã‚’è¡¨ã™
    - As-is : ç¾çŠ¶ã®æ§‹æˆ
    - To-be : å•é¡Œã‚’è¦‹ã¤ã‘ã¦ä¿®æ­£ã—ãŸå¾Œã®æ§‹æˆ
- ç’°å¢ƒã‚’è¡¨ã™
    - Original : æœ¬ç•ªç’°å¢ƒ (ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ãƒ™ãƒ¼ã‚¹ã®æ—¢å­˜ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯)
    - Emulated : æ¤œè¨¼ç’°å¢ƒ (ã‚³ãƒ³ãƒ†ãƒŠãƒ™ãƒ¼ã‚¹ã®æ¤œè¨¼ç”¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯)

As-is/To-be * Original/Emualted ã§4ã¤ã®è±¡é™ãŒã‚ã‚Šã¾ã™ã€‚ä½œæ¥­ã‚¹ãƒ†ãƒƒãƒ—ã¨ã—ã¦ã€â‘ ï½â‘£ã®é †ã«é€²ã‚ã¦ã„ãã¾ã™ã€‚

![demo_cycle](./fig_fy22demo/demo_cycle.png)

å®Ÿéš›ã«ä½¿ç”¨ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã‚„æ©Ÿèƒ½ã‚’å«ã‚ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ãƒ‡ãƒ¢ä¸­ã§å®Ÿéš›ã«ä½¿ç”¨ã—ã¦ã„ã‚‹ãƒ„ãƒ¼ãƒ«ã¯å¤ªå­—ã®ã‚‚ã®ã§ã™ã€‚

- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ãƒˆãƒãƒ­ã‚¸ã‚’æŠŠæ¡ã™ã‚‹ãŸã‚ã®ãƒ„ãƒ¼ãƒ«
    - ç‰©ç†ãƒˆãƒãƒ­ã‚¸ç®¡ç†: **Netbox**
    - NWæ©Ÿå™¨ã‚³ãƒ³ãƒ•ã‚£ã‚°ãƒ‘ãƒ¼ã‚µ/ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿: **Batfish**
- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒãƒ¼ãƒ‰æ“ä½œ
    - è‡ªå‹•åŒ–: **Ansible**
- è»½é‡ãªãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒãƒ¼ãƒ‰
    - CNF (Cloud-native Network Function), ã‚³ãƒ³ãƒ†ãƒŠãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¨ãƒ³ã‚¸ãƒ³
        - OSS: VyOS, FRR, â€¦
        - è£½å“: **Juniper cRPD**, **Arista cEOS,** Nokia SR Linux, Cisco XRd â€¦
    - ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢L2ã‚¹ã‚¤ãƒƒãƒ
        - OSS: **Open vSwitch**
    - NWæ¤œè¨¼ç”¨ã‚³ãƒ³ãƒ†ãƒŠã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿
        - **Containerlab**

![demo_tools](./fig_fy22demo/demo_tools.png)

# ç’°å¢ƒæº–å‚™

ç’°å¢ƒè¨­å®šã«ã¤ã„ã¦ã¯ãƒ‡ãƒ¢ç’°å¢ƒæ§‹ç¯‰ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

[ãƒ‡ãƒ¢ç’°å¢ƒæ§‹ç¯‰](./demo_env_setup.md) 

- `playground` ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ–ãƒ©ãƒ³ãƒã¯ `20230407` ã‚’é¸æŠã—ã¦ãã ã•ã„
- ãƒ‡ãƒ¢ã‚·ã‚¹ãƒ†ãƒ ã‚’èµ·å‹•ã—ã¦ãã ã•ã„ ( `docker compose up` )

Copy to emulated env ãƒ‡ãƒ¢ã§ã¯ã€ã‚»ã‚°ãƒ¡ãƒ³ãƒˆç§»è»¢ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã«ã¤ã„ã¦æ‰±ã„ã¾ã™ã€‚ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ = mddo-ospf, ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ = original_asis, emulated_asis, emulated_tobe ãŒãƒ™ãƒ¼ã‚¹ã«ãªã‚Šã¾ã™ã€‚

- å®Ÿéš›ã®ã‚³ãƒ³ãƒ•ã‚£ã‚°é¡: `playground/configs/mddo-ospf`
- ã‚³ãƒ³ãƒ•ã‚£ã‚°ãƒªãƒã‚¸ãƒˆãƒª: [ool-mddo/mddo-ospf](https://github.com/ool-mddo/mddo-ospf)

## æ¤œè¨¼ç’°å¢ƒ(Emulated env)ãƒ›ã‚¹ãƒˆå´ã®ç’°å¢ƒè¨­å®š

### Ansible-runner ã§ä½¿ç”¨ã™ã‚‹ãƒ¦ãƒ¼ã‚¶è¨­å®šã«ã¤ã„ã¦

ãƒ‡ãƒ¢ã§ä½¿ç”¨ã™ã‚‹ playbook ã¯ã€æ¤œè¨¼ç’°å¢ƒ(emulated env; containerlab ç­‰ã‚’å…¥ã‚Œã‚‹)ã‚µãƒ¼ãƒã®æ“ä½œã‚’è¡Œã†ãŸã‚ã« ssh login ã—ã¦ã„ã¾ã™ã€‚

- ãƒ­ã‚°ã‚¤ãƒ³ã«ä½¿ç”¨ã™ã‚‹ãƒ¦ãƒ¼ã‚¶åã‚’ `demo_vars:LOCALSERVER_USER` ã«å®šç¾©ã—ã¾ã™ã€‚
    - ãƒ¦ãƒ¼ã‚¶ã¯ ssh login, sudo å®Ÿè¡Œå¯èƒ½ã«ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
- ssh login, sudo ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ `env/passwords` ãƒ•ã‚¡ã‚¤ãƒ«ã«å®šç¾©ã—ã¾ã™ã€‚
- ssh ã™ã‚‹ã‚µãƒ¼ãƒã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ `inventory/hosts` ãƒ•ã‚¡ã‚¤ãƒ«ã«å®šç¾©ã—ã¾ã™ã€‚
    - ã“ã“ã§ã¯ã€ãƒ‡ãƒ¢ã‚·ã‚¹ãƒ†ãƒ ã¨Emulatedç’°å¢ƒã¯åŒä¸€ã®ã‚µãƒ¼ãƒä¸Šã§å‹•ä½œã™ã‚‹ã‚‚ã®ã¨ã—ã¦ã„ã¾ã™ã€‚ãã®ãŸã‚ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã¯ localhost ã«ãªã‚Šã¾ã™ã€‚ã“ã®æ¡ä»¶ã§ã‚ã‚Œã°å¤‰æ›´ã¯ä¸è¦ã§ã™ã€‚

![system_stack.drawio.png](./fig_fy22demo/system_stack.drawio.png)

### ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

ç’°å¢ƒã«åˆã‚ã›ã¦ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ« (`demo_vars`)ã‚’ç·¨é›†ã—ã¾ã™ã€‚ãƒ‡ãƒ¢ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œç’°å¢ƒã«åˆã‚ã›ã¦ä»¥ä¸‹ã®å¤‰æ•°ã‚’å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚

```bash
# in playground/demo/copy_to_emulated_env dir
vi demo_vars
```

- `ANSIBLERUNNER_IMAGE` : Ansible runner ç”¨ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒªãƒã‚¸ãƒˆãƒªURL
- `API_PROXY` : API_PROXYã§ä½¿ç”¨ã™ã‚‹ãƒãƒ¼ãƒˆ
- `API_BRIDGE` : ãƒ‡ãƒ¢ã‚·ã‚¹ãƒ†ãƒ ã«æ¥ç¶šã™ã‚‹ãŸã‚ã® docker bridge å
- `LOCALSERVER_USER` : ãƒ›ã‚¹ãƒˆã‚µãƒ¼ãƒã®ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼å
- `PLAYGROUND_DIR` : playgroundãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ãƒ‘ã‚¹(çµ¶å¯¾ãƒ‘ã‚¹)
- `ANSIBLERUNNER_DIR` : Ansible runnerå®Ÿè¡Œãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª

```bash
ANSIBLERUNNER_IMAGE="ghcr.io/ool-mddo/mddo-ansible-runner:v0.0.1"
API_PROXY="localhost:15000"
API_BRIDGE="playground_default"
LOCALSERVER_USER=mddo
PLAYGROUND_DIR="/home/${LOCALSERVER_USER}/playground"
ANSIBLE_RUNNER_DIR="${PLAYGROUND_DIR}/demo/copy_to_emulated_env"
```

ãƒ›ã‚¹ãƒˆä¸Šã®ãƒ¦ãƒ¼ã‚¶(`LOCALSERVER_USER`)ã®SSHãƒ­ã‚°ã‚¤ãƒ³ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¨sudoãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ `passwords` ãƒ•ã‚¡ã‚¤ãƒ«ã«è¨˜è¼‰ã—ã¾ã™(ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ã«æ³¨æ„ã—ã¦ãã ã•ã„)ã€‚

```bash
# in playground/demo/copy_to_emulated_env dir
vi env/passwords
```

```yaml
---
"^SSH password:\\s*?$": "login password"
"^BECOME password.*:\\s*?$": "sudo password"
```

# ãƒ‡ãƒ¢: ã‚»ã‚°ãƒ¡ãƒ³ãƒˆç§»è»¢

## Stepâ‘  As-Is (ç¾çŠ¶) ãƒ¢ãƒ‡ãƒ«ä½œæˆ

ãƒ‡ãƒ¢ç’°å¢ƒã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒªã‚½ãƒ¼ã‚¹åˆæœŸåŒ–ã¨Original Configã‹ã‚‰ Original As-Isãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚

```bash
# in playground/demo/copy_to_emulated_env/ dir
./demo_step1.sh
```

- å®Ÿè¡Œçµæœ
    
    ```json
    {"mddo-ospf":[{"physical":{"network":"mddo-ospf","snapshot":"original_asis","label":"OSPF model (original_asis)"},"logical":[]}]}ä»¥ä¸‹ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§Stepã”ã¨ã«Netovizã§ç¢ºèªå¯èƒ½ã§ã™ã€‚(option)
    ```
    

Netovizã¸ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦Original Asisãƒˆãƒãƒ­ã‚¸ãƒ¼ãŒç¢ºèªã§ãã¾ã™ã€‚

http://{{HOST_ADDRESS}}:3000/

## Stepâ‘¡ As-Is ä»®æƒ³ç’°å¢ƒä½œæˆ

Orginalç’°å¢ƒã‚’å†ç¾ã—ãŸä»®æƒ³ç’°å¢ƒ(Emulatedç’°å¢ƒ)ã‚’ä½œæˆã™ã‚‹ãŸã‚ã«ä»¥ä¸‹ã®å‡¦ç†ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

- Original As-Isãƒ¢ãƒ‡ãƒ«ã‹ã‚‰åå‰å¤‰æ›ã‚’è¡Œã„ã€Emulated As-Isãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆ
- Emulated As-Isãƒ¢ãƒ‡ãƒ«ã‹ã‚‰Emulated Configã‚’ç”Ÿæˆ
- Containerlabä¸Šã«Emulatedç’°å¢ƒã‚’ãƒ‡ãƒ—ãƒ­ã‚¤
    - Emulated config ã§å‹•ä½œã™ã‚‹ä»®æƒ³ç’°å¢ƒã‚’èµ·å‹•

```bash
./demo_step2.sh
```

- å®Ÿè¡Œçµæœ
    
    ```bash
    changed: [docker-host] => {
        "changed": true,
        "cmd": "cd /home/mddo/playground_20230407/demo/copy_to_emulated_env/clab && containerlab deploy --topo clab-topo.yml --reconfigure",
        "delta": "0:00:13.333936",
        "end": "2023-05-12 02:54:58.878629",
        "invocation": {
            "module_args": {
                "_raw_params": "cd /home/mddo/playground_20230407/demo/copy_to_emulated_env/clab && containerlab deploy --topo clab-topo.yml --reconfigure",
                "_uses_shell": true,
                "argv": null,
                "chdir": null,
                "creates": null,
                "executable": null,
                "removes": null,
                "stdin": null,
                "stdin_add_newline": true,
                "strip_empty_ends": true,
                "warn": false
            }
        },
        "msg": "",
        "rc": 0,
        "start": "2023-05-12 02:54:45.544693",
        "stderr": "time=\"2023-05-12T02:54:45Z\" level=info msg=\"Containerlab v0.32.1 started\"\ntime=\"2023-05-12T02:54:45Z\" level=info msg=\"Parsing & checking topology file: clab-topo.yml\"\ntime=\"2023-05-12T02:54:45Z\" level=info msg=\"Destroying lab: emulated\"\ntime=\"2023-05-12T02:54:51Z\" level=info msg=\"Removed container: clab-emulated-regiona-rt1\"\ntime=\"2023-05-12T02:54:51Z\" level=info msg=\"Removed container: clab-emulated-regionc-rt1\"\ntime=\"2023-05-12T02:54:51Z\" level=info msg=\"Removed container: clab-emulated-regiona-svr02\"\ntime=\"2023-05-12T02:54:51Z\" level=info msg=\"Removed container: clab-emulated-regiona-rt2\"\ntime=\"2023-05-12T02:54:51Z\" level=info msg=\"Removed container: clab-emulated-regionc-svr01\"\ntime=\"2023-05-12T02:54:51Z\" level=info msg=\"Removed container: clab-emulated-regionb-svr01\"\ntime=\"2023-05-12T02:54:51Z\" level=info msg=\"Removed container: clab-emulated-regionb-rt1\"\ntime=\"2023-05-12T02:54:51Z\" level=info msg=\"Removed container: clab-emulated-regionc-rt2\"\ntime=\"2023-05-12T02:54:51Z\" level=info msg=\"Removed container: clab-emulated-regionb-rt2\"\ntime=\"2023-05-12T02:54:51Z\" level=info msg=\"Removing containerlab host entries from /etc/hosts file\"\ntime=\"2023-05-12T02:54:51Z\" level=error msg=\"Error response from daemon: error while removing network: network clab id 505e0549e0d246c3811225682d4214c0143fc4ce92f579e9f8a3b0a40dbbab8a has active endpoints\"\ntime=\"2023-05-12T02:54:51Z\" level=info msg=\"Removing /home/mddo/playground_20230407/demo/copy_to_emulated_env/clab/clab-emulated directory...\"\ntime=\"2023-05-12T02:54:51Z\" level=info msg=\"Creating lab directory: /home/mddo/playground_20230407/demo/copy_to_emulated_env/clab/clab-emulated\"\ntime=\"2023-05-12T02:54:51Z\" level=warning msg=\"failed to enable LLDP on docker bridge: open /sys/class/net/br-dd5696ce39a4/bridge/group_fwd_mask: no such file or directory\"\ntime=\"2023-05-12T02:54:51Z\" level=warning msg=\"failed to disable TX checksum offloading for the br-dd5696ce39a4 bridge interface: no such device\"\ntime=\"2023-05-12T02:54:51Z\" level=info msg=\"Creating container: \\\"regiona-rt2\\\"\"\ntime=\"2023-05-12T02:54:51Z\" level=info msg=\"Creating container: \\\"regionc-rt1\\\"\"\ntime=\"2023-05-12T02:54:51Z\" level=info msg=\"Creating container: \\\"regionc-rt2\\\"\"\ntime=\"2023-05-12T02:54:51Z\" level=info msg=\"Creating container: \\\"regiona-svr02\\\"\"\ntime=\"2023-05-12T02:54:51Z\" level=info msg=\"Creating container: \\\"regionc-svr01\\\"\"\ntime=\"2023-05-12T02:54:51Z\" level=info msg=\"Creating container: \\\"regionb-rt1\\\"\"\ntime=\"2023-05-12T02:54:51Z\" level=info msg=\"Creating container: \\\"regionb-svr01\\\"\"\ntime=\"2023-05-12T02:54:51Z\" level=info msg=\"Creating container: \\\"regiona-rt1\\\"\"\ntime=\"2023-05-12T02:54:51Z\" level=info msg=\"Creating container: \\\"regionb-rt2\\\"\"\ntime=\"2023-05-12T02:54:54Z\" level=info msg=\"Creating virtual wire: br8:br8p0 <--> regiona-rt2:eth2\"\ntime=\"2023-05-12T02:54:54Z\" level=info msg=\"Creating virtual wire: br0:br0p1 <--> regiona-rt2:eth1\"\ntime=\"2023-05-12T02:54:54Z\" level=info msg=\"Creating virtual wire: br1:br1p0 <--> regiona-rt1:eth2\"\ntime=\"2023-05-12T02:54:54Z\" level=info msg=\"Creating virtual wire: br0:br0p0 <--> regiona-rt1:eth1\"\ntime=\"2023-05-12T02:54:54Z\" level=info msg=\"Creating virtual wire: br2:br2p0 <--> regiona-rt1:eth3\"\ntime=\"2023-05-12T02:54:55Z\" level=info msg=\"Creating virtual wire: br7:br7p1 <--> regionb-svr01:eth1\"\ntime=\"2023-05-12T02:54:56Z\" level=info msg=\"Creating virtual wire: br5:br5p0 <--> regionc-rt2:eth2\"\ntime=\"2023-05-12T02:54:56Z\" level=info msg=\"Creating virtual wire: br3:br3p1 <--> regionc-rt2:eth1\"\ntime=\"2023-05-12T02:54:56Z\" level=info msg=\"Creating virtual wire: br1:br1p1 <--> regionb-rt1:eth1\"\ntime=\"2023-05-12T02:54:56Z\" level=info msg=\"Creating virtual wire: br6:br6p0 <--> regionb-rt1:eth3\"\ntime=\"2023-05-12T02:54:56Z\" level=info msg=\"Creating virtual wire: br4:br4p1 <--> regionb-rt1:eth2\"\ntime=\"2023-05-12T02:54:57Z\" level=info msg=\"Creating virtual wire: br8:br8p1 <--> regiona-svr02:eth1\"\ntime=\"2023-05-12T02:54:57Z\" level=info msg=\"Creating virtual wire: br3:br3p0 <--> regionc-rt1:eth2\"\ntime=\"2023-05-12T02:54:57Z\" level=info msg=\"Creating virtual wire: br2:br2p1 <--> regionc-rt1:eth1\"\ntime=\"2023-05-12T02:54:57Z\" level=info msg=\"Creating virtual wire: br4:br4p0 <--> regionc-rt1:eth3\"\ntime=\"2023-05-12T02:54:58Z\" level=info msg=\"Creating virtual wire: br6:br6p1 <--> regionb-rt2:eth1\"\ntime=\"2023-05-12T02:54:58Z\" level=info msg=\"Creating virtual wire: br7:br7p0 <--> regionb-rt2:eth2\"\ntime=\"2023-05-12T02:54:58Z\" level=info msg=\"Creating virtual wire: br5:br5p1 <--> regionc-svr01:eth1\"\ntime=\"2023-05-12T02:54:58Z\" level=info msg=\"Adding containerlab host entries to /etc/hosts file\"\ntime=\"2023-05-12T02:54:58Z\" level=info msg=\"ğŸ‰ New containerlab version 0.41.0 is available! Release notes: https://containerlab.dev/rn/0.41/\\nRun 'containerlab version upgrade' to upgrade or go check other installation options at https://containerlab.dev/install/\\n\"",
        "stderr_lines": [
            "time=\"2023-05-12T02:54:45Z\" level=info msg=\"Containerlab v0.32.1 started\"",
            "time=\"2023-05-12T02:54:45Z\" level=info msg=\"Parsing & checking topology file: clab-topo.yml\"",
            "time=\"2023-05-12T02:54:45Z\" level=info msg=\"Destroying lab: emulated\"",
            "time=\"2023-05-12T02:54:51Z\" level=info msg=\"Removed container: clab-emulated-regiona-rt1\"",
            "time=\"2023-05-12T02:54:51Z\" level=info msg=\"Removed container: clab-emulated-regionc-rt1\"",
            "time=\"2023-05-12T02:54:51Z\" level=info msg=\"Removed container: clab-emulated-regiona-svr02\"",
            "time=\"2023-05-12T02:54:51Z\" level=info msg=\"Removed container: clab-emulated-regiona-rt2\"",
            "time=\"2023-05-12T02:54:51Z\" level=info msg=\"Removed container: clab-emulated-regionc-svr01\"",
            "time=\"2023-05-12T02:54:51Z\" level=info msg=\"Removed container: clab-emulated-regionb-svr01\"",
            "time=\"2023-05-12T02:54:51Z\" level=info msg=\"Removed container: clab-emulated-regionb-rt1\"",
            "time=\"2023-05-12T02:54:51Z\" level=info msg=\"Removed container: clab-emulated-regionc-rt2\"",
            "time=\"2023-05-12T02:54:51Z\" level=info msg=\"Removed container: clab-emulated-regionb-rt2\"",
            "time=\"2023-05-12T02:54:51Z\" level=info msg=\"Removing containerlab host entries from /etc/hosts file\"",
            "time=\"2023-05-12T02:54:51Z\" level=error msg=\"Error response from daemon: error while removing network: network clab id 505e0549e0d246c3811225682d4214c0143fc4ce92f579e9f8a3b0a40dbbab8a has active endpoints\"",
            "time=\"2023-05-12T02:54:51Z\" level=info msg=\"Removing /home/mddo/playground_20230407/demo/copy_to_emulated_env/clab/clab-emulated directory...\"",
            "time=\"2023-05-12T02:54:51Z\" level=info msg=\"Creating lab directory: /home/mddo/playground_20230407/demo/copy_to_emulated_env/clab/clab-emulated\"",
            "time=\"2023-05-12T02:54:51Z\" level=warning msg=\"failed to enable LLDP on docker bridge: open /sys/class/net/br-dd5696ce39a4/bridge/group_fwd_mask: no such file or directory\"",
            "time=\"2023-05-12T02:54:51Z\" level=warning msg=\"failed to disable TX checksum offloading for the br-dd5696ce39a4 bridge interface: no such device\"",
            "time=\"2023-05-12T02:54:51Z\" level=info msg=\"Creating container: \\\"regiona-rt2\\\"\"",
            "time=\"2023-05-12T02:54:51Z\" level=info msg=\"Creating container: \\\"regionc-rt1\\\"\"",
            "time=\"2023-05-12T02:54:51Z\" level=info msg=\"Creating container: \\\"regionc-rt2\\\"\"",
            "time=\"2023-05-12T02:54:51Z\" level=info msg=\"Creating container: \\\"regiona-svr02\\\"\"",
            "time=\"2023-05-12T02:54:51Z\" level=info msg=\"Creating container: \\\"regionc-svr01\\\"\"",
            "time=\"2023-05-12T02:54:51Z\" level=info msg=\"Creating container: \\\"regionb-rt1\\\"\"",
            "time=\"2023-05-12T02:54:51Z\" level=info msg=\"Creating container: \\\"regionb-svr01\\\"\"",
            "time=\"2023-05-12T02:54:51Z\" level=info msg=\"Creating container: \\\"regiona-rt1\\\"\"",
            "time=\"2023-05-12T02:54:51Z\" level=info msg=\"Creating container: \\\"regionb-rt2\\\"\"",
            "time=\"2023-05-12T02:54:54Z\" level=info msg=\"Creating virtual wire: br8:br8p0 <--> regiona-rt2:eth2\"",
            "time=\"2023-05-12T02:54:54Z\" level=info msg=\"Creating virtual wire: br0:br0p1 <--> regiona-rt2:eth1\"",
            "time=\"2023-05-12T02:54:54Z\" level=info msg=\"Creating virtual wire: br1:br1p0 <--> regiona-rt1:eth2\"",
            "time=\"2023-05-12T02:54:54Z\" level=info msg=\"Creating virtual wire: br0:br0p0 <--> regiona-rt1:eth1\"",
            "time=\"2023-05-12T02:54:54Z\" level=info msg=\"Creating virtual wire: br2:br2p0 <--> regiona-rt1:eth3\"",
            "time=\"2023-05-12T02:54:55Z\" level=info msg=\"Creating virtual wire: br7:br7p1 <--> regionb-svr01:eth1\"",
            "time=\"2023-05-12T02:54:56Z\" level=info msg=\"Creating virtual wire: br5:br5p0 <--> regionc-rt2:eth2\"",
            "time=\"2023-05-12T02:54:56Z\" level=info msg=\"Creating virtual wire: br3:br3p1 <--> regionc-rt2:eth1\"",
            "time=\"2023-05-12T02:54:56Z\" level=info msg=\"Creating virtual wire: br1:br1p1 <--> regionb-rt1:eth1\"",
            "time=\"2023-05-12T02:54:56Z\" level=info msg=\"Creating virtual wire: br6:br6p0 <--> regionb-rt1:eth3\"",
            "time=\"2023-05-12T02:54:56Z\" level=info msg=\"Creating virtual wire: br4:br4p1 <--> regionb-rt1:eth2\"",
            "time=\"2023-05-12T02:54:57Z\" level=info msg=\"Creating virtual wire: br8:br8p1 <--> regiona-svr02:eth1\"",
            "time=\"2023-05-12T02:54:57Z\" level=info msg=\"Creating virtual wire: br3:br3p0 <--> regionc-rt1:eth2\"",
            "time=\"2023-05-12T02:54:57Z\" level=info msg=\"Creating virtual wire: br2:br2p1 <--> regionc-rt1:eth1\"",
            "time=\"2023-05-12T02:54:57Z\" level=info msg=\"Creating virtual wire: br4:br4p0 <--> regionc-rt1:eth3\"",
            "time=\"2023-05-12T02:54:58Z\" level=info msg=\"Creating virtual wire: br6:br6p1 <--> regionb-rt2:eth1\"",
            "time=\"2023-05-12T02:54:58Z\" level=info msg=\"Creating virtual wire: br7:br7p0 <--> regionb-rt2:eth2\"",
            "time=\"2023-05-12T02:54:58Z\" level=info msg=\"Creating virtual wire: br5:br5p1 <--> regionc-svr01:eth1\"",
            "time=\"2023-05-12T02:54:58Z\" level=info msg=\"Adding containerlab host entries to /etc/hosts file\"",
            "time=\"2023-05-12T02:54:58Z\" level=info msg=\"ğŸ‰ New containerlab version 0.41.0 is available! Release notes: https://containerlab.dev/rn/0.41/\\nRun 'containerlab version upgrade' to upgrade or go check other installation options at https://containerlab.dev/install/\\n\""
        ],
        "stdout": "+---+-----------------------------+--------------+----------------+--------------+---------+-----------------+----------------------+\n| # |            Name             | Container ID |     Image      |     Kind     |  State  |  IPv4 Address   |     IPv6 Address     |\n+---+-----------------------------+--------------+----------------+--------------+---------+-----------------+----------------------+\n| 1 | clab-emulated-regiona-rt1   | 605cca5c53fc | crpd:22.1R1.10 | juniper_crpd | running | 172.20.20.3/24  | 2001:172:20:20::3/64 |\n| 2 | clab-emulated-regiona-rt2   | 3dee7c33d65a | crpd:22.1R1.10 | juniper_crpd | running | 172.20.20.2/24  | 2001:172:20:20::2/64 |\n| 3 | clab-emulated-regiona-svr02 | 3723c243d47a | crpd:22.1R1.10 | juniper_crpd | running | 172.20.20.7/24  | 2001:172:20:20::7/64 |\n| 4 | clab-emulated-regionb-rt1   | 0608481f8e55 | crpd:22.1R1.10 | juniper_crpd | running | 172.20.20.5/24  | 2001:172:20:20::5/64 |\n| 5 | clab-emulated-regionb-rt2   | 1ec3e6a416ea | crpd:22.1R1.10 | juniper_crpd | running | 172.20.20.9/24  | 2001:172:20:20::9/64 |\n| 6 | clab-emulated-regionb-svr01 | 2fc4a756d268 | crpd:22.1R1.10 | juniper_crpd | running | 172.20.20.4/24  | 2001:172:20:20::4/64 |\n| 7 | clab-emulated-regionc-rt1   | 5cbf141d3195 | crpd:22.1R1.10 | juniper_crpd | running | 172.20.20.8/24  | 2001:172:20:20::8/64 |\n| 8 | clab-emulated-regionc-rt2   | dc2c3a2d6a89 | crpd:22.1R1.10 | juniper_crpd | running | 172.20.20.6/24  | 2001:172:20:20::6/64 |\n| 9 | clab-emulated-regionc-svr01 | f524dea2d331 | crpd:22.1R1.10 | juniper_crpd | running | 172.20.20.10/24 | 2001:172:20:20::a/64 |\n+---+-----------------------------+--------------+----------------+--------------+---------+-----------------+----------------------+",
        "stdout_lines": [
            "+---+-----------------------------+--------------+----------------+--------------+---------+-----------------+----------------------+",
            "| # |            Name             | Container ID |     Image      |     Kind     |  State  |  IPv4 Address   |     IPv6 Address     |",
            "+---+-----------------------------+--------------+----------------+--------------+---------+-----------------+----------------------+",
            "| 1 | clab-emulated-regiona-rt1   | 605cca5c53fc | crpd:22.1R1.10 | juniper_crpd | running | 172.20.20.3/24  | 2001:172:20:20::3/64 |",
            "| 2 | clab-emulated-regiona-rt2   | 3dee7c33d65a | crpd:22.1R1.10 | juniper_crpd | running | 172.20.20.2/24  | 2001:172:20:20::2/64 |",
            "| 3 | clab-emulated-regiona-svr02 | 3723c243d47a | crpd:22.1R1.10 | juniper_crpd | running | 172.20.20.7/24  | 2001:172:20:20::7/64 |",
            "| 4 | clab-emulated-regionb-rt1   | 0608481f8e55 | crpd:22.1R1.10 | juniper_crpd | running | 172.20.20.5/24  | 2001:172:20:20::5/64 |",
            "| 5 | clab-emulated-regionb-rt2   | 1ec3e6a416ea | crpd:22.1R1.10 | juniper_crpd | running | 172.20.20.9/24  | 2001:172:20:20::9/64 |",
            "| 6 | clab-emulated-regionb-svr01 | 2fc4a756d268 | crpd:22.1R1.10 | juniper_crpd | running | 172.20.20.4/24  | 2001:172:20:20::4/64 |",
            "| 7 | clab-emulated-regionc-rt1   | 5cbf141d3195 | crpd:22.1R1.10 | juniper_crpd | running | 172.20.20.8/24  | 2001:172:20:20::8/64 |",
            "| 8 | clab-emulated-regionc-rt2   | dc2c3a2d6a89 | crpd:22.1R1.10 | juniper_crpd | running | 172.20.20.6/24  | 2001:172:20:20::6/64 |",
            "| 9 | clab-emulated-regionc-svr01 | f524dea2d331 | crpd:22.1R1.10 | juniper_crpd | running | 172.20.20.10/24 | 2001:172:20:20::a/64 |",
            "+---+-----------------------------+--------------+----------------+--------------+---------+-----------------+----------------------+"
        ]
    }
    META: ran handlers
    META: ran handlers
    
    PLAY RECAP *********************************************************************
    docker-host                : ok=7    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
    localhost                  : ok=11   changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
    ```
    

Containerlabã«Emulatedç’°å¢ƒãŒã§ãã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚

```bash
sudo containerlab inspect --all
```

- å®Ÿè¡Œçµæœ
    
    ```
    +---+--------------------+----------+-----------------------------+--------------+----------------+--------------+---------+-----------------+----------------------+
    | # |     Topo Path      | Lab Name |            Name             | Container ID |     Image      |     Kind     |  State  |  IPv4 Address   |     IPv6 Address     |
    +---+--------------------+----------+-----------------------------+--------------+----------------+--------------+---------+-----------------+----------------------+
    | 1 | clab/clab-topo.yml | emulated | clab-emulated-regiona-rt1   | aee25ceaa2bf | crpd:22.1R1.10 | juniper_crpd | running | 172.20.20.3/24  | 2001:172:20:20::3/64 |
    | 2 |                    |          | clab-emulated-regiona-rt2   | 6bcc05422fba | crpd:22.1R1.10 | juniper_crpd | running | 172.20.20.10/24 | 2001:172:20:20::a/64 |
    | 3 |                    |          | clab-emulated-regiona-svr02 | 53e853827e18 | crpd:22.1R1.10 | juniper_crpd | running | 172.20.20.5/24  | 2001:172:20:20::5/64 |
    | 4 |                    |          | clab-emulated-regionb-rt1   | 0a857687753b | crpd:22.1R1.10 | juniper_crpd | running | 172.20.20.4/24  | 2001:172:20:20::4/64 |
    | 5 |                    |          | clab-emulated-regionb-rt2   | 2243480da889 | crpd:22.1R1.10 | juniper_crpd | running | 172.20.20.9/24  | 2001:172:20:20::9/64 |
    | 6 |                    |          | clab-emulated-regionb-svr01 | 44705b40a685 | crpd:22.1R1.10 | juniper_crpd | running | 172.20.20.8/24  | 2001:172:20:20::8/64 |
    | 7 |                    |          | clab-emulated-regionc-rt1   | 0a5dfc7febff | crpd:22.1R1.10 | juniper_crpd | running | 172.20.20.7/24  | 2001:172:20:20::7/64 |
    | 8 |                    |          | clab-emulated-regionc-rt2   | 2331de043c93 | crpd:22.1R1.10 | juniper_crpd | running | 172.20.20.2/24  | 2001:172:20:20::2/64 |
    | 9 |                    |          | clab-emulated-regionc-svr01 | 1507afdcf528 | crpd:22.1R1.10 | juniper_crpd | running | 172.20.20.6/24  | 2001:172:20:20::6/64 |
    +---+--------------------+----------+-----------------------------+--------------+----------------+--------------+---------+-----------------+----------------------+
    ```
    

Netovizã¸ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦Emulated  Asisãƒˆãƒãƒ­ã‚¸ãƒ¼ãŒç¢ºèªã§ãã¾ã™ã€‚

http://{{HOST_ADDRESS}}:3000/

## 

## æ­£ã—ãã€Œã‚³ãƒ”ãƒ¼ã€ã§ãã¦ã„ã‚‹ã‹ã©ã†ã‹ã®æ¤œè¨¼

ã“ã®ç¢ºèªã‚¹ãƒ†ãƒƒãƒ—ã¯å¿…é ˆã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚åˆæœŸèµ·å‹•æ™‚ãªã©ã€å‹•ä½œç¢ºèªã‚’ã‚¹ãƒ†ãƒƒãƒ—ã‚’è¿½ã£ã¦è¡Œã„ãŸã„å ´åˆã«å®Ÿæ–½ã—ã¦ãã ã•ã„ã€‚

Emulated As-Isãƒ¢ãƒ‡ãƒ«ã‹ã‚‰Emulatedç’°å¢ƒãŒæ­£ã—ãæ§‹ç¯‰ãƒ»èµ·å‹•ã§ãã¦ã„ã‚‹ã‹ç¢ºèªã™ã‚‹ãŸã‚ã€èµ·å‹•ã—ãŸEmulatedç’°å¢ƒã«æ‰‹ã‚’åŠ ãˆãªã„çŠ¶æ…‹ã§ Stepâ‘¢ ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

- Stepâ‘¢ã§ã¯ã€Emulatedç’°å¢ƒã®ãƒãƒ¼ãƒ‰ã®ã‚³ãƒ³ãƒ•ã‚£ã‚°ã‚’å–å¾—ã—ã€ãã‚Œã‚’åŸºã«ãƒˆãƒãƒ­ã‚¸ãƒ‡ãƒ¼ã‚¿(emulated_tobe ãƒ¢ãƒ‡ãƒ«)ã‚’ç”Ÿæˆã—ã¾ã™ã€‚
- èµ·å‹•ã—ãŸEmulatedç’°å¢ƒã§ä½•ã‚‚å¤‰æ›´ã‚’åŠ ãˆã¦ã„ãªã„ (ã“ã®å¾Œã® Stepâ‘¡â€™ ã‚’å®Ÿè¡Œã—ãªã„) çŠ¶æ…‹ã§ Stepâ‘¢ ã‚’å®Ÿæ–½ã™ã‚‹ã®ã§ã€emulated asis = emulated tobe ã«ãªã‚‹çŠ¶æ…‹ã‚’ä½œã£ã¦ã„ã¾ã™ã€‚
- ã“ã®çŠ¶æ…‹ã§ emulated asis/tobe ãƒ¢ãƒ‡ãƒ«ã®å·®åˆ†ã‚’æ¯”è¼ƒã—ã¾ã™ã€‚å·®åˆ†ãŒãªã„å ´åˆã€Emulated As-Isãƒ¢ãƒ‡ãƒ«ã‹ã‚‰Emulated Configã®ç”ŸæˆãŒæ­£ã—ãè¡Œã‚ã‚Œã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚

![static_inspection](./fig_fy22demo/static_inspection.png)

```bash
./demo_step3.sh
```

- å®Ÿè¡Œçµæœ
    
    ```bash
    <çœç•¥>
    changed: [docker-host] => {
        "changed": true,
        "cmd": "docker-compose run netomox-exp bundle exec netomox diff -c /mddo/netoviz_model/mddo-ospf/emulated_asis/topology.json /mddo/netoviz_model/mddo-ospf/emulated_tobe/emulated_tobe_filtered.json",
        "delta": "0:00:05.383461",
        "end": "2023-04-06 16:15:01.141429",
        "invocation": {
            "module_args": {
                "_raw_params": "docker-compose run netomox-exp bundle exec netomox diff -c /mddo/netoviz_model/mddo-ospf/emulated_asis/topology.json /mddo/netoviz_model/mddo-ospf/emulated_tobe/emulated_tobe_filtered.json",
                "_uses_shell": true,
                "argv": null,
                "chdir": "/home/mddo/playground",
                "creates": null,
                "executable": null,
                "removes": null,
                "stdin": null,
                "stdin_add_newline": true,
                "strip_empty_ends": true,
                "warn": false
            }
        },
        "msg": "",
        "rc": 0,
        "start": "2023-04-06 16:14:55.757968",
        "stderr": "Creating playground_netomox-exp_run ... \r\nCreating playground_netomox-exp_run ... done",
        "stderr_lines": [
            "Creating playground_netomox-exp_run ... ",
            "Creating playground_netomox-exp_run ... done"
        ],
        "stdout": "  {\r\n\r\n  }",
        "stdout_lines": [
            "  {",
            "",
            "  }"
        ]
    }
    META: ran handlers
    META: ran handlers
    
    PLAY RECAP *********************************************************************
    docker-host                : ok=21   changed=11   unreachable=0    failed=0    skipped=3    rescued=0    ignored=0
    ```
    

Netovizã¸ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦Emulated As-is/To-Beãƒˆãƒãƒ­ã‚¸ãƒ¼ã«å·®åˆ†ãŒå‡ºã¦ã„ãªã„ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚

http://{{HOST_ADDRESS}}:3000/

ã¾ãŸã€CLIã§Emulated As-Is/To-Beãƒˆãƒãƒ­ã‚¸ãƒ¼ã®å·®åˆ†ãŒãªã„ã“ã¨ã‚’ç¢ºèªã§ãã¾ã™ã€‚

```jsx
mddo-toolbox snapshot_diff -n mddo-ospf -s emulated_asis -d emulated_tobe -c
```

- å®Ÿè¡Œçµæœ
    
    ```bash
    I, [2023-06-04T12:51:26.084215 #3694104]  INFO -- mddo-toolbox: GET: http://localhost:15000//conduct/mddo-ospf/snapshot_diff/emulated_asis/emulated_tobe, param={}
      {
    
      }
    ```
    

## Stepâ‘¡â€™ ä»®æƒ³ç’°å¢ƒä¸Šã§ã®æ¤œè¨¼

Containerlabä¸Šã«å»ºã¦ãŸEmuratedç’°å¢ƒã§æ¤œè¨¼ã‚’å®Ÿæ–½ã—ã¾ã™ã€‚ã“ã“ã§ã¯ Stepâ‘¡ã§æ§‹ç¯‰ã—ãŸ as-is ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãŒæ­£ã—ãå‹•ä½œã™ã‚‹ã‹ã©ã†ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚

```
$ docker exec -it clab-emulated-regiona-rt1 cli
root@regiona-rt1> show route 192.168.100.0/25 

root@regiona-rt1> exit

$ docker exec -it clab-emulated-regionb-rt1 cli
root@regionb-rt1> show route 192.168.100.0/25 

root@regionb-rt1> exit

$ docker exec -it clab-demo202301-regionc-rt1 cli
root@regionc-rt1> show route 192.168.100.0/25 

inet.0: 15 destinations, 16 routes (15 active, 0 holddown, 0 hidden)
+ = Active Route, - = Last Active, * = Both

192.168.100.0/25   *[Static/1] 00:29:18, metric 0
                    >  to 192.168.2.2 via eth2

root@regionc-rt1> exit 
```

`show route` ã‹ã‚‰ä»¥ä¸‹ã®ç‚¹ãŒã‚ã‹ã‚Šã¾ã™ã€‚

- 192.168.100.0/25ã®çµŒè·¯ãŒregionc-rt1ä»¥å¤–ã«èã“ãˆã¦ã„ãªã„ã€‚
- regionc-rt1ã«redistributeã®è¨­å®šãŒä¸è¶³ã—ã¦ã„ã‚‹ã€‚

ä¿®æ­£ã™ã‚‹ãŸã‚ã«ã€regionc-rt1ã«ã¦ä¸è¶³ã—ã¦ã„ã‚‹staticã¨directã®redistributeã®è¨­å®šã‚’å…¥ã‚Œã¾ã™ã€‚

```
docker exec -it clab-emulated-regionc-rt1 cli

configure
set policy-options policy-statement ospf-redistribute from protocol direct
set policy-options policy-statement ospf-redistribute from protocol static
set policy-options policy-statement ospf-redistribute then accept
set protocols ospf export ospf-redistribute
show | compare

commit
```

```
$ docker exec -it clab-demo202301-regionc-rt1 cli

root@regionc-rt1> configure 
Entering configuration mode

[edit]
root@regionc-rt1# set policy-options policy-statement ospf-redistribute from protocol direct 

[edit]
root@regionc-rt1# set policy-options policy-statement ospf-redistribute from protocol static 

[edit]
root@regionc-rt1# set policy-options policy-statement ospf-redistribute then accept 

[edit]
root@regionc-rt1# set protocols ospf export ospf-redistribute 

root@regionc-rt1# show | compare 
[edit]
+  policy-options {
+      policy-statement ospf-redistribute {
+          from protocol [ direct static ];
+          then accept;
+      }
+  }
[edit protocols ospf]
+   export ospf-redistribute;

[edit]
root@regionc-rt1# commit 
commit complete
```

As-is ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«å¯¾ã™ã‚‹ä¿®æ­£ã‚’åŠ ãˆã¾ã—ãŸã€‚ä¿®æ­£ã‚’åŠ ãˆãŸå¾Œã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ To-be ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¨ã—ã¾ã™ã€‚

## Stepâ‘¢ To-Be (ç†æƒ³) ãƒ¢ãƒ‡ãƒ«ä½œæˆ

As-is ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«ã¯å•é¡ŒãŒã‚ã‚Šã€ä¿®æ­£ã‚’åŠ ãˆãŸã®ã§ä»¥é™ã¯ã“ã‚Œã‚’æœ¬ç•ª(Original)ç’°å¢ƒã«ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã—ã¦ã„ãã‚¹ãƒ†ãƒƒãƒ—ã«ãªã‚Šã¾ã™ã€‚ãã®ãŸã‚ã«Stepâ‘¢ã§ã¯ä»¥ä¸‹ã®æ“ä½œã‚’è¡Œã„ã¾ã™ã€‚

- å¤‰æ›´ã‚’åŠ ãˆãŸEmulatedç’°å¢ƒ (Emulated To-Be ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯) ã®Configã‹ã‚‰Emulated To-Be ãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆã™ã‚‹
- Emulated As-Isãƒ¢ãƒ‡ãƒ«(å¤‰æ›´å‰)ã¨Emulated To-Beãƒ¢ãƒ‡ãƒ«(å¤‰æ›´å¾Œ)ã®Diffã‚’ã¨ã‚‹

```bash
./demo_step3.sh
```

- å®Ÿè¡Œçµæœ
    
    ```bash
    ...
    ok: [docker-host] => (item={'name': 'Seg_192.168.1.0/30', 'agent_name': 'Seg-192.168.1.0-30', 'type': 'segment', 'if_list': [{'name': 'regionb-rt1_eth3.0', 'agent_name': 'Ethernet1', 'ipv4': None, 'description': 'to_regionb-rt1_eth3.0', 'original_if': 'regionb-rt1_Ethernet1'}, {'name': 'regionb-rt2_eth1.0', 'agent_name': 'Ethernet2', 'ipv4': None, 'description': 'to_regionb-rt2_eth1.0', 'original_if': 'regionb-rt2_Ethernet1'}]}) => {"ansible_loop_var": "item", "changed": false, "connection": "close", "content_length": "5", "content_type": "application/json", "cookies": {}, "cookies_string": "", "date": "Fri, 12 May 2023 02:59:17 GMT", "elapsed": 0, "item": {"agent_name": "Seg-192.168.1.0-30", "if_list": [{"agent_name": "Ethernet1", "description": "to_regionb-rt1_eth3.0", "ipv4": null, "name": "regionb-rt1_eth3.0", "original_if": "regionb-rt1_Ethernet1"}, {"agent_name": "Ethernet2", "description": "to_regionb-rt2_eth1.0", "ipv4": null, "name": "regionb-rt2_eth1.0", "original_if": "regionb-rt2_Ethernet1"}], "name": "Seg_192.168.1.0/30", "type": "segment"}, "json": null, "msg": "OK (5 bytes)", "redirected": false, "server": "nginx/1.21.6", "status": 200, "url": "http://localhost:15000/configs/mddo-ospf/emulated_tobe/"}
    skipping: [docker-host] => (item={'name': 'regionb-rt2', 'agent_name': 'regionb-rt2', 'type': 'node', 'if_list': [{'name': 'eth1.0', 'agent_name': 'eth1.0', 'ipv4': '192.168.1.2/30', 'description': 'to_Seg-192.168.1.0-30_Ethernet2', 'original_if': 'Ethernet1'}, {'name': 'eth2.0', 'agent_name': 'eth2.0', 'ipv4': '192.168.254.1/24', 'description': 'to_Seg-192.168.254.0-24_Ethernet1', 'original_if': 'Ethernet2'}]})  => {"ansible_loop_var": "item", "changed": false, "item": {"agent_name": "regionb-rt2", "if_list": [{"agent_name": "eth1.0", "description": "to_Seg-192.168.1.0-30_Ethernet2", "ipv4": "192.168.1.2/30", "name": "eth1.0", "original_if": "Ethernet1"}, {"agent_name": "eth2.0", "description": "to_Seg-192.168.254.0-24_Ethernet1", "ipv4": "192.168.254.1/24", "name": "eth2.0", "original_if": "Ethernet2"}], "name": "regionb-rt2", "type": "node"}, "skip_reason": "Conditional result was False"}
    ok: [docker-host] => (item={'name': 'Seg_192.168.254.0/24', 'agent_name': 'Seg-192.168.254.0-24', 'type': 'segment', 'if_list': [{'name': 'regionb-rt2_eth2.0', 'agent_name': 'Ethernet1', 'ipv4': None, 'description': 'to_regionb-rt2_eth2.0', 'original_if': 'regionb-rt2_Ethernet2'}, {'name': 'regionb-svr01_eth1.0', 'agent_name': 'Ethernet2', 'ipv4': None, 'description': 'to_regionb-svr01_eth1.0', 'original_if': 'regionb-svr01_ens2'}]}) => {"ansible_loop_var": "item", "changed": false, "connection": "close", "content_length": "5", "content_type": "application/json", "cookies": {}, "cookies_string": "", "date": "Fri, 12 May 2023 02:59:18 GMT", "elapsed": 0, "item": {"agent_name": "Seg-192.168.254.0-24", "if_list": [{"agent_name": "Ethernet1", "description": "to_regionb-rt2_eth2.0", "ipv4": null, "name": "regionb-rt2_eth2.0", "original_if": "regionb-rt2_Ethernet2"}, {"agent_name": "Ethernet2", "description": "to_regionb-svr01_eth1.0", "ipv4": null, "name": "regionb-svr01_eth1.0", "original_if": "regionb-svr01_ens2"}], "name": "Seg_192.168.254.0/24", "type": "segment"}, "json": null, "msg": "OK (5 bytes)", "redirected": false, "server": "nginx/1.21.6", "status": 200, "url": "http://localhost:15000/configs/mddo-ospf/emulated_tobe/"}
    skipping: [docker-host] => (item={'name': 'regionb-svr01', 'agent_name': 'regionb-svr01', 'type': 'endpoint', 'if_list': [{'name': 'eth1.0', 'agent_name': 'eth1.0', 'ipv4': '192.168.254.10/24', 'description': 'to_Seg-192.168.254.0-24_Ethernet2', 'original_if': 'ens2'}]})  => {"ansible_loop_var": "item", "changed": false, "item": {"agent_name": "regionb-svr01", "if_list": [{"agent_name": "eth1.0", "description": "to_Seg-192.168.254.0-24_Ethernet2", "ipv4": "192.168.254.10/24", "name": "eth1.0", "original_if": "ens2"}], "name": "regionb-svr01", "type": "endpoint"}, "skip_reason": "Conditional result was False"}
    ok: [docker-host] => (item={'name': 'Seg_192.168.100.0/24', 'agent_name': 'Seg-192.168.100.0-24', 'type': 'segment', 'if_list': [{'name': 'regiona-rt2_eth2.0', 'agent_name': 'Ethernet1', 'ipv4': None, 'description': 'to_regiona-rt2_eth2.0', 'original_if': 'regiona-rt2_ge-0/0/1.0'}, {'name': 'regiona-svr02_eth1.0', 'agent_name': 'Ethernet2', 'ipv4': None, 'description': 'to_regiona-svr02_eth1.0', 'original_if': 'regiona-svr02_ens2'}]}) => {"ansible_loop_var": "item", "changed": false, "connection": "close", "content_length": "5", "content_type": "application/json", "cookies": {}, "cookies_string": "", "date": "Fri, 12 May 2023 02:59:19 GMT", "elapsed": 0, "item": {"agent_name": "Seg-192.168.100.0-24", "if_list": [{"agent_name": "Ethernet1", "description": "to_regiona-rt2_eth2.0", "ipv4": null, "name": "regiona-rt2_eth2.0", "original_if": "regiona-rt2_ge-0/0/1.0"}, {"agent_name": "Ethernet2", "description": "to_regiona-svr02_eth1.0", "ipv4": null, "name": "regiona-svr02_eth1.0", "original_if": "regiona-svr02_ens2"}], "name": "Seg_192.168.100.0/24", "type": "segment"}, "json": null, "msg": "OK (5 bytes)", "redirected": false, "server": "nginx/1.21.6", "status": 200, "url": "http://localhost:15000/configs/mddo-ospf/emulated_tobe/"}
    skipping: [docker-host] => (item={'name': 'regiona-svr02', 'agent_name': 'regiona-svr02', 'type': 'endpoint', 'if_list': [{'name': 'eth1.0', 'agent_name': 'eth1.0', 'ipv4': '192.168.100.210/24', 'description': 'to_Seg-192.168.100.0-24_Ethernet2', 'original_if': 'ens2'}]})  => {"ansible_loop_var": "item", "changed": false, "item": {"agent_name": "regiona-svr02", "if_list": [{"agent_name": "eth1.0", "description": "to_Seg-192.168.100.0-24_Ethernet2", "ipv4": "192.168.100.210/24", "name": "eth1.0", "original_if": "ens2"}], "name": "regiona-svr02", "type": "endpoint"}, "skip_reason": "Conditional result was False"}
    
    PLAY RECAP *********************************************************************
    docker-host                : ok=7    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
    {"mddo-ospf":[{"physical":{"network":"mddo-ospf","snapshot":"emulated_tobe","label":"OSPF model (emulated_tobe)"},"logical":[]}]}{}
    ```
    

Netovizã¸ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦emulated As-IS/To-Beãƒˆãƒãƒ­ã‚¸ãƒ¼ã®å·®åˆ†ãŒç¢ºèªã§ãã¾ã™

http://{{HOST_ADDRESS}}:3000/

![diff_asis_tobe](./fig_fy22demo/diff_asis_tobe.png)

ã¾ãŸã€CLIã§ã‚‚emulated As-Is/To-Beãƒˆãƒãƒ­ã‚¸ãƒ¼ã®å·®åˆ†ãŒç¢ºèªã§ãã¾ã™

```bash
mddo-toolbox snapshot_diff -n mddo-ospf -s emulated_asis -d emulated_tobe -c
```

- å®Ÿè¡Œçµæœ
    
    ```json
    I, [2023-06-04T13:06:29.883305 #3700695]  INFO -- mddo-toolbox: GET: http://localhost:15000//conduct/mddo-ospf/snapshot_diff/emulated_asis/emulated_tobe, param={}
      {
    .   ietf-network:networks: {
    .     network: [
    .       {
              network-types: {
                mddo-topology:ospf-area-network: {
    
                }
              },
    .         network-id: ospf_area0,
    .         node: [
    .           {
    .             node-id: regionc-rt1,
                  ietf-network-topology:termination-point: [
    
                  ],
                  supporting-node: [
    
                  ],
    .             mddo-topology:ospf-area-node-attributes: {
    .               node-type: ospf_proc,
    .               router-id: 192.168.2.1,
    .               process-id: default,
    .               log-adjacency-change: false,
    .               redistribute: [
    +                 {
    +                   protocol: connected,
    +                   metric-type: 2
    +                 },
    +                 {
    +                   protocol: static,
    +                   metric-type: 2
    +                 }
    .               ],
    .               router-id-source: static
    .             }
    .           }
    .         ],
              ietf-network-topology:link: [
    
              ],
              supporting-network: [
    
              ]
    .       }
    .     ]
    .   }
      }
    ```
    

## Stepâ‘£ To-Be å®Ÿç’°å¢ƒã¸ã®é©ç”¨

Emulatedç’°å¢ƒã§å®Ÿæ–½ã—ãŸå¤‰æ›´ã‚’å®Ÿç’°å¢ƒã¸é©ç”¨ã™ã‚‹ãŸã‚ã«ä»¥ä¸‹ã®æ“ä½œã‚’è¡Œã„ã¾ã™ã€‚

- Emulated To-Beãƒ¢ãƒ‡ãƒ«ã‹ã‚‰åå‰å¤‰æ›ã‚’è¡Œã„ã€Original To-Beãƒ¢ãƒ‡ãƒ«ã‚’ç”Ÿæˆ
- Original As-Isãƒ¢ãƒ‡ãƒ«ã¨Original To-Beãƒ¢ãƒ‡ãƒ«ã§Diffã‚’è¡Œã„ã€å·®åˆ†ã‚³ãƒ³ãƒ•ã‚£ã‚°ã‚’ç”Ÿæˆ

```bash
./demo_step4.sh
```

- å®Ÿè¡Œçµæœ
    
    ```bash
    {}{}{}[
      {
        "config": "router ospf 65000\n redistribute connected metric 1 metric-type 2",
        "node-id": "regionc-rt1"
      },
      {
        "config": "router ospf 65000\n redistribute static metric 1 metric-type 2",
        "node-id": "regionc-rt1"
      }
    ]
    ```
    

å·®åˆ†ã‚³ãƒ³ãƒ•ã‚£ã‚°ãŒå‡ºåŠ›ã•ã‚Œã¾ã™ã€‚ã“ã®ãƒ‡ãƒ¢ã§ã¯æœ¬ç•ª(Original)ç’°å¢ƒã¸ã®å·®åˆ†ã‚³ãƒ³ãƒ•ã‚£ã‚°ã®æŠ•å…¥ã¯æ—¢å­˜ã®é‹ç”¨ãƒ•ãƒ­ãƒ¼ã«æ²¿ã£ã¦å®Ÿæ–½ã—ã¦ã„ãã“ã¨ã‚’æƒ³å®šã—ã¦ã„ã¾ã™ã€‚

ä»¥ä¸Šã§ãƒ‡ãƒ¢ã¯çµ‚äº†ã§ã™ã€‚

## æ¤œè¨¼ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯(emulated env)å‰Šé™¤

ãƒ‡ãƒ¢ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ(ãƒ‡ãƒ¢æ‰‹é †)ã«ã¯ã€Stepâ‘¡ã§èµ·å‹•ã—ãŸä»®æƒ³ç’°å¢ƒã‚’åœæ­¢ãƒ»å‰Šé™¤ã™ã‚‹æ“ä½œãŒã‚ã‚Šã¾ã›ã‚“ã€‚èµ·å‹•å¾Œã¯æ‰‹å‹•ã§å‰Šé™¤ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```bash
sudo ./demo_remove.sh
```

# æ¤œè¨¼çµæœ

## æ¤œè¨¼ç’°å¢ƒã®ãƒªã‚½ãƒ¼ã‚¹

å®Ÿè¡Œæ™‚é–“ã«ã¤ã„ã¦ã¯[ãƒ‡ãƒ¢å‹•ç”»](https://youtu.be/wu9IWRbiKKU)ã‚‚å‚ç…§ã—ã¦ãã ã•ã„ã€‚

- ãƒ‡ãƒ¢ãŠã‚ˆã³NTTComæ¤œè¨¼ç’°å¢ƒã®å†ç¾ã§ä½¿ç”¨ã—ã¦ã„ã‚‹æ©Ÿå™¨(ã‚µãƒ¼ãƒ)ã¯åŒã˜ã§ã™ã€‚
    - CPU : Xeon Silver 4216(16C/32T)
    - Mem : 64GB
    - CNF : Juniper cRPD

|  |  | ãƒ‡ãƒ¢ | NTTComæ¤œè¨¼ç’°å¢ƒ |
| --- | --- | --- | --- |
| æ¤œè¨¼ç’°å¢ƒã‚µã‚¤ã‚º | NWãƒãƒ¼ãƒ‰(CNF) | 6 | 12 |
|  | ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæ•°(OVS) | 9 | 12 |
| ä½¿ç”¨ãƒªã‚½ãƒ¼ã‚¹ | CPU (ãƒ”ãƒ¼ã‚¯) | 40% | 42% |
|  | Mem (å¢—åˆ†) | +2GB | +2GB |
| å‡¦ç†æ™‚é–“(sec) | åˆè¨ˆ | 153 | 187 |
|  | Stepâ‘  | 14 | 14 |
|  | Stepâ‘¡ | 93 | 125 |
|  | Stepâ‘¢ | 41 | 43 |
|  | Stepâ‘£ | 5 | 5 |

å†ç¾ã™ã‚‹è¦æ¨¡ã«å¯¾ã—ã¦ã€æ¶ˆè²»ãƒªã‚½ãƒ¼ã‚¹ã¯ãã‚Œã»ã©å¢—ãˆã¾ã›ã‚“ã§ã—ãŸãŒã€ãƒ‡ãƒ—ãƒ­ã‚¤å‡¦ç†æ™‚é–“(Stepâ‘¡)ã¯å¢—åŠ å‚¾å‘ãŒè¦‹ãˆã¾ã™ã€‚

ä»Šå›ä½¿ç”¨ã—ã¦ã„ã‚‹ã‚µãƒ¼ãƒã§ã‚‚30ãƒãƒ¼ãƒ‰ç¨‹åº¦ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã§ã‚ã‚Œã°ç’°å¢ƒãŒèµ·å‹•ã§ãã‚‹ã¨æ€ã‚ã‚Œã¾ã™ã€‚

## èª²é¡Œç‚¹

### è­˜åˆ¥å­ã®å¤‰æ›ã¨ã‚³ãƒ³ãƒ•ã‚£ã‚°ã®ãƒ‘ãƒ¼ã‚¹ã«é–¢ã™ã‚‹è¤‡é›‘ã•

- æ¤œè¨¼ä½œæ¥­æ™‚(â‘¡')ã«ã€å¯¾å¿œã™ã‚‹å…ƒ(Original)ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹åãŒã‚ã‹ã‚‰ãªã„
    - ğŸ‘‰Interface descriptionã«å…ƒã®ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹åã‚’åŸ‹ã‚ã¦å¯¾å¿œ (æ­£ç›´ã‚¤ãƒã‚¤ãƒ)
- CNFã ã¨ãƒãƒ¼ãƒŸãƒ³ã‚°ãƒ«ãƒ¼ãƒ«ãŒå¤§ããé•ã†
    - Loopbackç³» : `lo0` or `lo.0` or `lo0.0` ? (cRPDãŒ`lo.0`ã¨ã‹ãªã‚Šç‰¹æ®Š)
    - ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯IFç³» : `ethX` (NWæ©Ÿå™¨ã¨ã¯ç•°ãªã‚‹ãƒ«ãƒ¼ãƒ«ãŒå‡ºã¦ãã‚‹)
        - ğŸ‘‰[Batfishã§ã‚ªãƒ¬ã‚ªãƒ¬ãƒ‘ãƒƒãƒ](https://github.com/ool-mddo/batfish/tree/ool-mddo-patches)ã‚’ä½œã£ã¦å¯¾å¿œ
- Batfish (Config parser) å•é¡Œ
    - IOSç³»ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹åã®æ­£è¦åŒ–ãƒ«ãƒ¼ãƒ«ã®é•ã„
        - 10Gã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹ã¯çœç•¥å½¢(`TenGigE`)ã§æ­£è¦åŒ–ã™ã‚‹ãŒã€100Gã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹ã¯ãƒ•ãƒ«ãƒãƒ¼ãƒ (`HundredGigabitEthernet`)ã§æ­£è¦åŒ–ã™ã‚‹
    - ä¸€éƒ¨ã‚³ãƒ³ãƒ•ã‚£ã‚°ã® "èª¤èª­" (èª¤parse)
        - ğŸ‘‰[Batfishã‚ªãƒ¬ã‚ªãƒ¬ãƒ‘ãƒƒãƒ](https://github.com/ool-mddo/batfish/tree/ool-mddo-patches)
    - OVSéå¯¾å¿œ
        - ğŸ‘‰OVSã«ã™ã‚‹å‰ã«Arista cEOSã‚’ä½¿ã£ã¦ã„ãŸã®ã§ã€cEOSã®ã‚³ãƒ³ãƒ•ã‚£ã‚°ã‚’Batfishå‘ã‘ã«ç”Ÿæˆã—ã¦ã€OVSã®ä»£ã‚ã‚Šã®ã‚³ãƒ³ãƒ•ã‚£ã‚°ã¨ã—ã¦ã‚³ãƒ³ãƒ•ã‚£ã‚°ãƒ‘ãƒ¼ã‚¹ã•ã›ã¦ã„ã‚‹
        - L3 segmentã‚’OVSã§å†ç¾ã—ã¦ã„ã‚‹ãŒã€ãƒ¢ãƒ‡ãƒ«ãƒ‡ãƒ¼ã‚¿ä¸ŠL3ã§åå‰ã‚’ä¸€æ„ã«è­˜åˆ¥ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€ã‚ã‚‹ç¨‹åº¦è¤‡é›‘ãªåå‰ãŒå¿…è¦ã«ãªã‚‹ã€‚ä¸€æ–¹ã€OVSã§å®Ÿåƒã™ã‚‹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ãŸã¦ã‚ˆã†ã¨ã™ã‚‹ã¨ã€OVSã‚„OSå´ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹(veth)åã®åˆ¶ç´„ãŒã‚ã‚‹ãŸã‚ãã®ã¾ã¾åŒã˜åå‰ã‚’ä½¿ãˆãªã„ã€‚ã¾ãŸã€BatfishãŒOVS configã‚’èª­ã‚ãªã„ãŸã‚ã€ã„ã£ãŸã‚“åˆ¥ãªã‚³ãƒ³ãƒ•ã‚£ã‚°(Batfish ãŒèª­ã‚ã‚‹ã‚³ãƒ³ãƒ•ã‚£ã‚°: ä»Šå›ã¯ Arista cEOS)ã«ç½®ãæ›ãˆã¦ã„ã‚‹ãŒã€ã“ã®æ™‚ã«ã‚‚ã¾ãŸã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹åãƒ«ãƒ¼ãƒ«ãŒå¤‰ã‚ã£ã¦ã—ã¾ã†
            - ğŸ‘‰ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«å¿œã˜ãŸã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹åã®ä½¿ã„åˆ†ã‘
- åŒã˜emulated namespaceã®ç¯„å›²å†…ã§ã‚‚ã€è¦‹ã‚‹å´ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«ã‚ˆã£ã¦è­˜åˆ¥å­ã®ä½¿ã„åˆ†ã‘ã‚’ã—ãªã‘ã‚Œã°ã„ã‘ãªã„ã‚‚ã®ãŒã‚ã‚‹
    - ãƒ¢ãƒ‡ãƒ«ãƒ‡ãƒ¼ã‚¿å†…ã®ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹å
    - ãƒ›ã‚¹ãƒˆOSå´ã‹ã‚‰è¦‹ãŸæ™‚ã®ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹å
    - ã‚³ãƒ³ãƒ†ãƒŠå†…(ã‚³ãƒ³ãƒ†ãƒŠã¨ã—ã¦å‹•ä½œã™ã‚‹Network OS)ãŒã‚ã‹ã‚‰ã¿ãŸã¨ãã®ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹å
    - ğŸ‘‰å¤‰æ›ãƒ†ãƒ¼ãƒ–ãƒ«ã§ç”¨é€”åˆ¥ã®åå‰ã‚’ç®¡ç†ã™ã‚‹ã“ã¨ã§å¯¾å¿œ
    
    ### Containerlab ã¨ CNF ã®å–ã‚Šæ‰±ã„
    
- Containerlab Linux Bridgeå•é¡Œ
    - ãƒ›ã‚¹ãƒˆOSã®Linux Bridgeã‚’ä½¿ã†ãŸã‚ã€ãƒ›ã‚¹ãƒˆå´ã®Dockerä¸Šã«å­˜åœ¨ã—ã¦ã„ã‚‹Containerlabä»¥å¤–ã®ä»®æƒ³ãƒ–ãƒªãƒƒã‚¸ã®çµŒè·¯ã¨Emulatedç’°å¢ƒä¸Šã§çµŒè·¯ãŒé‡è¤‡ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã€ä½¿ãˆãªã‹ã£ãŸã€‚
    - ğŸ‘‰åˆæœŸã¯OVSã‚³ãƒ³ãƒ†ãƒŠã‚’ä½¿ã†ã“ã¨ã§å¯¾å¿œã€‚ãã®å¾Œã¯ [Openvswitch bridge - containerlab](https://containerlab.dev/manual/kinds/ovs-bridge/) ã§å¯¾å¿œã€‚OVSã‚³ãƒ³ãƒ†ãƒŠã¨ãƒ›ã‚¹ãƒˆå´ã®OVS bridgeã‚’ä½¿ã†ã®ã¨ã§ã¯ã€ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹åã®ä¸€æ„æ€§ã‚’ä¿è¨¼ã—ãªã‘ã‚Œã°ã„ã‘ãªã„ç¯„å›²ãŒå¤‰ã‚ã‚‹ã®ã§æ³¨æ„ãŒå¿…è¦ã€‚
- ç®¡ç†ã‚¢ã‚¯ã‚»ã‚¹IFå•é¡Œ
    - ã‚³ãƒ³ãƒ•ã‚£ã‚°ã«è¦‹ãˆã¦ã“ãªã„ã®ã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«ã«è¦‹ãˆã¦ãã‚‹
    - OSPFã§ä½™åˆ†ã«ç®¡ç†IFã®çµŒè·¯ã‚’åºƒå ±
    - ç®¡ç†IFã§OSPFã®çµŒè·¯äº¤æ›ã—ã¦ã—ã¾ã†
    - ğŸ‘‰ã‚³ãƒ³ãƒ•ã‚£ã‚°ã§æ‰“ã¡æ¶ˆã›ã‚‹è¨­å®šãªã‚‰ã€ã‚¼ãƒ­ã‚¿ãƒƒãƒã‚³ãƒ³ãƒ•ã‚£ã‚°ç”Ÿæˆæ™‚ã«æ‰“ã¡æ¶ˆã—ã‚³ãƒ³ãƒ•ã‚£ã‚°å…¥ã‚Œè¾¼ã‚€